// ViewIcoSphere.js

var GL = bongiovi.GL;
var gl;
var glm = bongiovi.glm;
var vertices = [[0,52.573111,85.065081],[0,-52.573111,85.065081],[85.065081,0,52.573111],[85.065081,0,-52.573111],[0,52.573111,-85.065081],[0,-52.573111,-85.065081],[-85.065081,0,-52.573111],[-85.065081,0,52.573111],[52.573111,85.065081,0],[-52.573111,85.065081,0],[-52.573111,-85.065081,0],[52.573111,-85.065081,0],[29.524181,95.542256,0],[0,100,0],[-29.524181,95.542256,0],[14.76209,68.171835,71.656692],[30.901699,80.901699,50],[44.286271,86.418783,23.885564],[-14.76209,68.171835,71.656692],[-30.901699,80.901699,50],[-44.286271,86.418783,23.885564],[86.418783,23.885564,44.286271],[80.901699,50,30.901699],[68.171835,71.656692,14.76209],[23.885564,44.286271,86.418783,],[50,30.901699,80.901699],[71.656692,14.76209,68.171835],[86.418783,23.885564,-44.286271],[80.901699,50,-30.901699],[68.171835,71.656692,-14.76209],[95.542256,0,29.524181],[100,0,0],[95.542256,0,-29.524181],[14.76209,68.171835,-71.656692],[30.901699,80.901699,-50],[44.286271,86.418783,-23.885564],[71.656692,14.76209,-68.171835],[50,30.901699,-80.901699],[23.885564,44.286271,-86.418783],[-14.76209,68.171835,-71.656692],[-30.901699,80.901699,-50],[-44.286271,86.418783,-23.885564],[-86.418783,23.885564,-44.286271],[-80.901699,50,-30.901699],[-68.171835,71.656692,-14.76209],[-23.885564,44.286271,-86.418783],[-50,30.901699,-80.901699],[-71.656692,14.76209,-68.171835],[-86.418783,23.885564,44.286271],[-80.901699,50,30.901699],[-68.171835,71.656692,14.76209],[-95.542256,0,-29.524181],[-100,0,0],[-95.542256,0,29.524181],[-23.885564,44.286271,86.418783],[-50,30.901699,80.901699],[-71.656692,14.76209,68.171835],[-29.524181,-95.542256,0],[0,-100,0],[29.524181,-95.542256,0],[-14.76209,-68.171835,71.656692],[-30.901699,-80.901699,50],[-44.286271,-86.418783,23.885564],[14.76209,-68.171835,71.656692],[30.901699,-80.901699,50],[44.286271,-86.418783,23.885564],[86.418783,-23.885564,44.286271],[80.901699,-50,30.901699],[68.171835,-71.656692,14.76209],[23.885564,-44.286271,86.418783],[50,-30.901699,80.901699],[71.656692,-14.76209,68.171835],[86.418783,-23.885564,-44.286271],[80.901699,-50,-30.901699],[68.171835,-71.656692,-14.76209],[71.656692,-14.76209,-68.171835],[50,-30.901699,-80.901699],[23.885564,-44.286271,-86.418783],[14.76209,-68.171835,-71.656692],[30.901699,-80.901699,-50],[44.286271,-86.418783,-23.885564],[-14.76209,-68.171835,-71.656692],[-30.901699,-80.901699,-50],[-44.286271,-86.418783,-23.885564],[-23.885564,-44.286271,-86.418783],[-50,-30.901699,-80.901699],[-71.656692,-14.76209,-68.171835],[-86.418783,-23.885564,-44.286271],[-80.901699,-50,-30.901699],[-68.171835,-71.656692,-14.76209],[-86.418783,-23.885564,44.286271],[-80.901699,-50,30.901699],[-68.171835,-71.656692,14.76209],[-23.885564,-44.286271,86.418783],[-50,-30.901699,80.901699],[-71.656692,-14.76209,68.171835],[0,29.524181,95.542256],[0,0,100],[0,-29.524181,95.542256],[0,29.524181,-95.542256],[0,0,-100],[0,-29.524181,-95.542256],[-16.245985,95.105652,26.286556],[16.245985,95.105652,26.286556],[0,85.065081,52.573111],[58.778525,68.819096,42.53254],[68.819096,42.53254,58.778525],[42.53254,58.778525,68.819096],[85.065081,52.573111,0],[95.105652,26.286556,-16.245985],[95.105652,26.286556,16.245985],[58.778525,68.819096,-42.53254],[42.53254,58.778525,-68.819096],[68.819096,42.53254,-58.778525],[16.245985,95.105652,-26.286556],[-16.245985,95.105652,-26.286556],[0,85.065081,-52.573111],[-42.53254,58.778525,-68.819096],[-58.778525,68.819096,-42.53254],[-68.819096,42.53254,-58.778525],[-95.105652,26.286556,-16.245985],[-85.065081,52.573111,0],[-95.105652,26.286556,16.245985],[-58.778525,68.819096,42.53254],[-42.53254,58.778525,68.819096],[-68.819096,42.53254,58.778525],[16.245985,-95.105652,26.286556],[-16.245985,-95.105652,26.286556],[0,-85.065081,52.573111],[68.819096,-42.53254,58.778525],[58.778525,-68.819096,42.53254],[42.53254,-58.778525,68.819096],[95.105652,-26.286556,16.245985],[95.105652,-26.286556,-16.245985],[85.065081,-52.573111,0],[68.819096,-42.53254,-58.778525],[42.53254,-58.778525,-68.819096],[58.778525,-68.819096,-42.53254],[0,-85.065081,-52.573111],[-16.245985,-95.105652,-26.286556],[16.245985,-95.105652,-26.286556],[-42.53254,-58.778525,-68.819096],[-68.819096,-42.53254,-58.778525],[-58.778525,-68.819096,-42.53254],[-95.105652,-26.286556,-16.245985],[-95.105652,-26.286556,16.245985],[-85.065081,-52.573111,0],[-68.819096,-42.53254,58.778525],[-42.53254,-58.778525,68.819096],[-58.778525,-68.819096,42.53254],[-26.286556,-16.245985,95.105652],[-52.573111,0,85.065081],[-26.286556,16.245985,95.105652],[52.573111,0,85.065081],[26.286556,-16.245985,95.105652],[26.286556,16.245985,95.105652],[26.286556,16.245985,-95.105652],[26.286556,-16.245985,-95.105652],[52.573111,0,-85.065081],[-26.286556,16.245985,-95.105652],[-52.573111,0,-85.065081],[-26.286556,-16.245985,-95.105652]];
var faces = [[21,15,10],[103,14,15],[15,21,103],[20,103,21],[104,13,14],[14,103,104],[105,104,103],[103,20,105],[19,105,20],[18,9,13],[13,104,18],[17,18,104],[104,105,17],[16,17,105],[105,19,16],[1,16,19],[18,24,9],[106,23,24],[24,18,106],[17,106,18],[107,22,23],[23,106,107],[108,107,106],[106,17,108],[16,108,17],[27,3,22],[22,107,27],[26,27,107],[107,108,26],[25,26,108],[108,16,25],[1,25,16],[24,30,9],[109,29,30],[30,24,109],[23,109,24],[110,28,29],[29,109,110],[111,110,109],[109,23,111],[22,111,23],[33,4,28],[28,110,33],[32,33,110],[110,111,32],[31,32,111],[111,22,31],[3,31,22],[30,36,9],[112,35,36],[36,30,112],[29,112,30],[113,34,35],[35,112,113],[114,113,112],[112,29,114],[28,114,29],[39,5,34],[34,113,39],[38,39,113],[113,114,38],[37,38,114],[114,28,37],[4,37,28],[36,13,9],[115,14,13],[13,36,115],[35,115,36],[116,15,14],[14,115,116],[117,116,115],[115,35,117],[34,117,35],[42,10,15],[15,116,42],[41,42,116],[116,117,41],[40,41,117],[117,34,40],[5,40,34],[46,40,5],[118,41,40],[40,46,118],[47,118,46],[119,42,41],[41,118,119],[120,119,118],[118,47,120],[48,120,47],[45,10,42],[42,119,45],[44,45,119],[119,120,44],[43,44,120],[120,48,43],[7,43,48],[52,43,7],[121,44,43],[43,52,121],[53,121,52],[122,45,44],[44,121,122],[123,122,121],[121,53,123],[54,123,53],[51,10,45],[45,122,51],[50,51,122],[122,123,50],[49,50,123],[123,54,49],[8,49,54],[51,21,10],[124,20,21],[21,51,124],[50,124,51],[125,19,20],[20,124,125],[126,125,124],[124,50,126],[49,126,50],[55,1,19],[19,125,55],[56,55,125],[125,126,56],[57,56,126],[126,49,57],[8,57,49],[66,60,12],[127,59,60],[60,66,127],[65,127,66],[128,58,59],[59,127,128],[129,128,127],[127,65,129],[64,129,65],[63,11,58],[58,128,63],[62,63,128],[128,129,62],[61,62,129],[129,64,61],[2,61,64],[72,67,3],[130,68,67],[67,72,130],[71,130,72],[131,69,68],[68,130,131],[132,131,130],[130,71,132],[70,132,71],[66,12,69],[69,131,66],[65,66,131],[131,132,65],[64,65,132],[132,70,64],[2,64,70],[67,31,3],[133,32,31],[31,67,133],[68,133,67],[134,33,32],[32,133,134],[135,134,133],[133,68,135],[69,135,68],[73,4,33],[33,134,73],[74,73,134],[134,135,74],[75,74,135],[135,69,75],[12,75,69],[73,76,4],[136,77,76],[76,73,136],[74,136,73],[137,78,77],[77,136,137],[138,137,136],[136,74,138],[75,138,74],[79,6,78],[78,137,79],[80,79,137],[137,138,80],[81,80,138],[138,75,81],[12,81,75],[79,82,6],[139,83,82],[82,79,139],[80,139,79],[140,84,83],[83,139,140],[141,140,139],[139,80,141],[81,141,80],[58,11,84],[84,140,58],[59,58,140],[140,141,59],[60,59,141],[141,81,60],[12,60,81],[82,85,6],[142,86,85],[85,82,142],[83,142,82],[143,87,86],[86,142,143],[144,143,142],[142,83,144],[84,144,83],[88,7,87],[87,143,88],[89,88,143],[143,144,89],[90,89,144],[144,84,90],[11,90,84],[88,52,7],[145,53,52],[52,88,145],[89,145,88],[146,54,53],[53,145,146],[147,146,145],[145,89,147],[90,147,89],[91,8,54],[54,146,91],[92,91,146],[146,147,92],[93,92,147],[147,90,93],[11,93,90],[91,96,8],[148,95,96],[96,91,148],[92,148,91],[149,94,95],[95,148,149],[150,149,148],[148,92,150],[93,150,92],[61,2,94],[94,149,61],[62,61,149],[149,150,62],[63,62,150],[150,93,63],[11,63,93],[99,94,2],[151,95,94],[94,99,151],[98,151,99],[152,96,95],[95,151,152],[153,152,151],[151,98,153],[97,153,98],[57,8,96],[96,152,57],[56,57,152],[152,153,56],[55,56,153],[153,97,55],[1,55,97],[27,72,3],[154,71,72],[72,27,154],[26,154,27],[155,70,71],[71,154,155],[156,155,154],[154,26,156],[25,156,26],[99,2,70],[70,155,99],[98,99,155],[155,156,98],[97,98,156],[156,25,97],[1,97,25],[39,100,5],[157,101,100],[100,39,157],[38,157,39],[158,102,101],[101,157,158],[159,158,157],[157,38,159],[37,159,38],[78,6,102],[102,158,78],[77,78,158],[158,159,77],[76,77,159],[159,37,76],[4,76,37],[100,46,5],[160,47,46],[46,100,160],[101,160,100],[161,48,47],[47,160,161],[162,161,160],[160,101,162],[102,162,101],[87,7,48],[48,161,87],[86,87,161],[161,162,86],[85,86,162],[162,102,85],[6,85,102]];
var glslify = require("glslify");

function ViewIcoSphere() {
	// bongiovi.View.call(this, glslify("../shaders/ico.vert"), bongiovi.ShaderLibs.get("simpleColorFrag"));
	bongiovi.View.call(this, glslify("../shaders/ico.vert"), glslify("../shaders/globe.frag"));
}

var p = ViewIcoSphere.prototype = new bongiovi.View();
p.constructor = ViewIcoSphere;


p._init = function() {
	gl = GL.gl;
	var positions = [];
	var coords = [];
	var indices = []; 
	var count = 0;

	for(var i=0; i<faces.length; i++) {
		var f = faces[i];
		var v0 = vertices[f[0]-1];
		var v1 = vertices[f[1]-1];
		var v2 = vertices[f[2]-1];
		positions.push(v0);
		positions.push(v1);
		positions.push(v2);

		coords.push([0, 0]);
		coords.push([0, 0]);
		coords.push([0, 0]);

		indices.push(count * 3 + 0);
		indices.push(count * 3 + 1);
		indices.push(count * 3 + 1);
		indices.push(count * 3 + 2);
		indices.push(count * 3 + 2);
		indices.push(count * 3 + 0);

		count ++;
	}

	this.mesh = new bongiovi.Mesh(positions.length, indices.length, GL.gl.LINES);
	this.mesh.bufferVertex(positions);
	this.mesh.bufferTexCoords(coords);
	this.mesh.bufferIndices(indices);
};

p.render = function(light0, light1, pointers) {
	var positions = [];
	for(var i=0; i<10; i++) {
		var p = pointers[i];
		if (p) {
			var l = glm.vec3.length(p.pos);
			if(l > params.sphereSize || 1){
				positions.push(p.pos[0]);
				positions.push(p.pos[1]);
				positions.push(p.pos[2]);	
			} else {
				positions.push(0);
				positions.push(0);
				positions.push(0);	
			}
			
		} else {
			positions.push(0);
			positions.push(0);
			positions.push(0);
		}
	}

	this.shader.bind();
	gl.lineWidth(.5);
	this.shader.uniform("color", "uniform3fv", [1, 1, .95]);
	this.shader.uniform("opacity", "uniform1f", .25);
	this.shader.uniform("sphereSize", "uniform1f", params.sphereSize-4);

	this.shader.uniform("light0", "uniform3fv", light0);
	this.shader.uniform("light1", "uniform3fv", light1);
	this.shader.uniform("pointers", "uniform3fv", positions);
	var ambient = .5;
	this.shader.uniform("ambient", "uniform3fv", [ambient, ambient, ambient]);
	this.shader.uniform("lightAmount", "uniform1f", 0.5);
	GL.draw(this.mesh);
};

module.exports = ViewIcoSphere;